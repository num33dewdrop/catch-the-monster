$(function(){var r=new function(){var a={SPIDER:"fa-spider",GHOST:"fa-ghost",DRAGON:"fa-dragon"},s="SPIDER",o=1,i=function(e,t,n,s,o,i){var l=$(".display"+o+">.js-btn-monster"+i),a=$(".display"+o+">.skeleton"+i);this.name=e,this.ico=t,this.point=n,this.moveSpeed=function(){l.css({transition:"all "+s+"s cubic-bezier(0.22, 0.61, 0.36, 1) 0s"})},this.moveMonster=function(){var e=Number($(".js-set-square").text()),t=Math.floor(Math.random()*e+1),n=$(".parts"+t),s=n.offset().left,o=n.offset().top,i=n.width(),a=n.height(),c=s+i/2-l.width()/2,r=o+a/2-l.height()/2;l.css({top:r+"px",left:c+"px"})},this.moveInit=function(){var e=a.offset().top,t=a.offset().left,n=e-2.6;l.css({top:n+"px",left:t+"px",transition:""})},this.indexUp=function(){l.css({"z-index":2})},this.indexDown=function(){l.css({"z-index":1})},this.sizeUp=function(){l.removeClass("monster-size")},this.sizeDown=function(){l.addClass("monster-size")}},c=function(e,t,n){return"SPIDER"===s?e=new i("SPIDER",a.SPIDER,200,3,t,n):"GHOST"===s?e=new i("GHOST",a.GHOST,300,2,t,n):"DRAGON"===s&&(e=new i("DRAGON",a.DRAGON,500,1.5,t,n)),e},r=c(r,1,1),l={},d={},u=[r],n=[];return{moveStartAll:function(){$.each(u,function(e,t){n[e]=setInterval(function(){u[e].moveMonster()},3e3)})},showModal:function(){var e=$(window).width(),t=$(".js-show-modal"),n=e/2-t.innerWidth()/2;t.attr({style:"margin-left:"+n+"px"}),t.show(),$(".js-modal-cover").show(),$(".js-hide-modal").on("click",function(){$(".js-show-modal").hide(),$(".js-modal-cover").hide()})},gameOver:function(){var e=$(window).width(),t=$(".js-show-game-over"),n=e/2-t.innerWidth()/2;t.attr({style:"margin-left:"+n+"px"}),t.show(),$(".js-modal-cover").show(),$(".js-retry").on("click",function(){location.reload()})},callbackDisplay:function(e,t){o=e,$(".js-monster-num").text(e),function(){var e=$(".monster-container"),t=[];e.removeClass(["display1","display2","display3"]),e.addClass("display"+o);for(var n=1;n<=o;n++)t.push('<i class="fa-solid '+u[0].ico+" skeleton skeleton"+n+'"></i><button type="submit" class="js-btn-monster'+n+' choice-monster jsCatchMonster"><i class="fa-solid '+u[0].ico+'"></i></button>');e.html(t)}(),t()},switchMonsterNum:function(){for(var e=[],t=[r,l,d],n=0;n<o;n++)t[n]=c(t[n],o,n+1),e.push(t[n]);u=e},switchMoveMonster:function(e){"move"===e?$.each(u,function(e,t){u[e].moveMonster()}):"speed"===e?$.each(u,function(e,t){u[e].moveSpeed()}):"init"===e?$.each(u,function(e,t){u[e].moveInit(),clearInterval(n[e])}):"upIndex"===e?$.each(u,function(e,t){u[e].indexUp()}):"downIndex"===e?$.each(u,function(e,t){u[e].indexDown()}):"upSize"===e?$.each(u,function(e,t){u[e].sizeUp()}):"downSize"===e&&$.each(u,function(e,t){u[e].sizeDown()})},changeClass:function(n){var s=Object.assign({},a);$.each(s,function(e,t){n===t&&delete s[e]});var o=$(".monster-container>i"),i=$(".choice-monster>i");o.add(i).addClass(n),$.each(s,function(e,t){o.add(i).removeClass(t)})},disabledInit:function(){0!==Number($(".js-set-square").text())&&$(".js-set-username").text().length?($(".js-start-game").prop("disabled",!1),$(".ex-name").text("START")):($(".js-start-game").prop("disabled",!0),$(".ex-name").text(u[0].name))},changeColor100:function(){100===Number($(".js-set-square").text())?$(".choice-monster,.choice-monster:disabled,.start-game,.start-game:disabled").css("color","darkred"):$(".choice-monster,.choice-monster:disabled,.start-game,.start-game:disabled").css("color","#666")},setName:function(e){s=e},getName:function(){return s},getNum:function(){return o},getMonstersArray:function(){return u},getIntervalIds:function(){return n}}};document.addEventListener("dblclick",function(e){e.preventDefault()},{passive:!1}),$("ul.menu li").hover(function(){$("ul.submenu:not(:animated)",this).slideDown()},function(){$("ul.submenu",this).slideUp()}),$("ul.menu li").on("click",function(){$("ul.submenu:not(:animated)",this).slideToggle()}),$(".js-get-name").on("keyup",function(){$(this).val()?$(".js-submit-disabled").prop("disabled",!1):$(".js-submit-disabled").prop("disabled",!0)}),$(".js-submit-disabled").on("click",function(e){e.preventDefault(),$(".js-hide-init").show(),$(".js-show-init").hide(),r.switchMoveMonster("init"),$.ajax({type:"post",url:"ajax.php",dataType:"json",data:{username:$(".js-get-name").val()}}).done(function(e,t){var n=JSON.parse(JSON.stringify(e));console.log(n),console.log(t),$(".js-set-username").text(n.username),$(".js-get-point-max").text(n.getPointMax)}).done(function(e,t){r.disabledInit()}).fail(function(e){console.log("Ajax fail"+e)})}),r.switchMoveMonster("init"),$(".jsCatchMonster").prop("disabled",!0),$(".js-init-game").on("click",function(){location.reload()}),$(".choice-spider,.choice-ghost,.choice-dragon").on("click",function(){r.setName($(this).text()),r.switchMonsterNum(),r.changeClass(r.getMonstersArray()[0].ico),r.switchMoveMonster("init"),$(".ex-name").text(r.getMonstersArray()[0].name)}),$(".single,.double,.triple").on("click",function(){r.callbackDisplay(Number($(this).text()),function(){r.switchMonsterNum(),r.switchMoveMonster("init"),r.changeColor100(),$(".jsCatchMonster").prop("disabled",!0)})}),$(".js-square64,.js-square100").on("click",function(){var e=[64,100],t=Number($(this).text()),n=e.indexOf(t),s=[],o=$(".js-set-square");100===t&&100!==Number(o.text())?$(".choice-monster").addClass("roll-animation"):$(".choice-monster").removeClass("roll-animation"),o.text(t),e.splice(n,1);for(var i=1;i<=t;i++)s.push('<div class="parts parts'+i+'"><button class="btn btnParts btn'+i+' jsClick"></button></div>');$(".container").html(s).addClass("container"+t),$.each(e,function(e,t){$(".container").removeClass("container"+t)}),r.changeColor100(),r.disabledInit()}),$(".js-start-game").on("click",function(){var a=$(".game-over").children(".inner");a.addClass("active");var c=setTimeout(function(){$.ajax({type:"post",url:"ajax.php",dataType:"json",data:{game_over:!0},complete:function(){console.log("ajax complete"),$("html, body").animate({scrollTop:0}),r.gameOver()}}).done(function(e,t){console.log(t)}).fail(function(e){console.log("Ajax fail")})},2e4);$(this).prop("disabled",!0),$(".ex-name").text(r.getMonstersArray()[0].name),$(".js-disabled-menu>li").not(".js-not-disabled").css("pointer-events","none"),r.switchMoveMonster("downIndex"),r.switchMoveMonster("speed"),setTimeout(function(){r.switchMoveMonster("downSize"),setTimeout(function(){r.switchMoveMonster("move")},100)},2e3),r.moveStartAll(),$(".js-switch-show").show("slow",function(){$("html, body").animate({scrollTop:$("body").get(0).scrollHeight},1e3)}),$(".jsCatchMonster").prop("disabled",!1),$(".jsClick").on("click",function(){var e=$(this);$(this).addClass("isAction"),setTimeout(function(){e.removeClass("isAction")},1800)}),$(".jsCatchMonster").on("click",function(){var n=$(this),e=$(this).parent(),t=e.find("button"),s=Number($(".js-get-point").text()),o=Number($(".js-get-monsters").text()),i=Number($(".js-get-point-max").text());$(this).prop("disabled",!0),$.each(t,function(e,t){t===n[0]&&(r.getMonstersArray()[e].sizeUp(),r.getMonstersArray()[e].indexUp(),r.getMonstersArray()[e].moveInit(),clearInterval(r.getIntervalIds()[e]),s+=r.getMonstersArray()[e].point,o+=1,i<s&&(i=s,$(".js-get-point-max").text(i)),$(".js-get-point").text(s),$(".js-get-monsters").text(o))}),e.find(".monster-size").length||($(".js-switch-show").hide("slow",function(){$("html, body").animate({scrollTop:0})}),$(".js-disabled-menu>li").css("pointer-events","auto"),a.removeClass("active"),clearTimeout(c),r.showModal(),r.disabledInit(),n.off("click"),$(".jsClick").off("click")),$.ajax({type:"post",url:"ajax.php",dataType:"json",data:{username:$(".js-get-name").val(),getPointMax:i}}).done(function(e,t){var n=JSON.parse(JSON.stringify(e));$(".js-get-point-max").text(n.getPointMax)}).fail(function(e){console.log("Ajax fail")})})})});